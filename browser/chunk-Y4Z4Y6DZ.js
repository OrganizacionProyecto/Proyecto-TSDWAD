import{B as G,C as J,D as K,G as Q,H as X,I as Y,K as Z,M as $,b as D,d as z,j as N,m as R,n as L,q as B,r as q,s as U,u as A,v as H}from"./chunk-GUVUN3OM.js";import{Ab as y,Ac as k,Bb as f,Bc as W,Ib as j,Jb as r,Kb as V,Lb as x,Nb as m,Ob as g,Pb as u,Rb as T,Ua as c,Ub as v,Va as h,Vb as w,Y as S,ba as O,ha as E,kb as C,mb as _,qa as p,ra as s,sb as o,tb as i,uc as F,vc as I,yb as P}from"./chunk-3TYVTQLD.js";var ee=(()=>{class a{constructor(e){this.http=e,this.apiUrl="https://aymara.pythonanywhere.com/api/cart/pedido/crear/"}crearPedido(e){return this.http.post(this.apiUrl,e)}descargarPDF(e){let n=`https://aymara.pythonanywhere.com/api/cart/pedidos/${e}/factura/`;return this.http.get(n,{responseType:"blob"})}static{this.\u0275fac=function(n){return new(n||a)(O(D))}}static{this.\u0275prov=S({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();function ie(a,b){if(a&1&&(o(0,"div",20)(1,"div",21)(2,"h3"),r(3),i(),o(4,"p"),r(5),i(),o(6,"p"),r(7),v(8,"currency"),i()()()),a&2){let e=b.$implicit;c(3),V(e.nombre_producto),c(2),x("Cantidad: ",e.cantidad,""),c(2),x("Precio: ",w(8,3,e.precio_unitario),"")}}function ne(a,b){if(a&1){let e=P();o(0,"div",22)(1,"h3"),r(2,"Informaci\xF3n de la Tarjeta"),i(),o(3,"div",12)(4,"label",23),r(5,"N\xFAmero de Tarjeta"),i(),o(6,"input",24),u("ngModelChange",function(t){p(e);let d=f();return g(d.numero_tarjeta,t)||(d.numero_tarjeta=t),s(t)}),i()(),o(7,"div",12)(8,"label",25),r(9,"Fecha de Vencimiento"),i(),o(10,"input",26),u("ngModelChange",function(t){p(e);let d=f();return g(d.fecha_expiracion,t)||(d.fecha_expiracion=t),s(t)}),i()(),o(11,"div",12)(12,"label",27),r(13,"CVV"),i(),o(14,"input",28),u("ngModelChange",function(t){p(e);let d=f();return g(d.codigo_seguridad,t)||(d.codigo_seguridad=t),s(t)}),i()()()}if(a&2){let e=f();c(6),m("ngModel",e.numero_tarjeta),c(4),m("ngModel",e.fecha_expiracion),c(4),m("ngModel",e.codigo_seguridad)}}function re(a,b){if(a&1){let e=P();o(0,"button",29),y("click",function(){p(e);let t=f();return s(t.descargarPDF())}),r(1," Descargar PDF del Pedido "),i()}}var fe=(()=>{class a{constructor(e,n,t){this.carritoService=e,this.pedidoService=n,this.router=t,this.carrito=[],this.metodoPago="tarjeta",this.numero_tarjeta="",this.fecha_expiracion="",this.codigo_seguridad="",this.direccion="",this.telefono="",this.pedidoRealizado=!1,this.pedidoId=null}ngOnInit(){this.obtenerCarrito()}obtenerCarrito(){this.carritoService.obtenerCarrito().subscribe({next:e=>{this.carrito=e.detalles_producto},error:e=>{console.error("Error al obtener el carrito:",e)}})}calcularTotal(){return this.carrito.reduce((e,n)=>e+Number(n.total_producto),0)}realizarPedido(){if(!this.direccion||!this.telefono){alert("Debes completar direcci\xF3n y tel\xE9fono.");return}let e={metodo_pago:this.metodoPago,direccion_entrega:this.direccion,telefono:this.telefono};if(this.metodoPago==="tarjeta"){if(!this.numero_tarjeta||!this.fecha_expiracion||!this.codigo_seguridad){alert("Completa todos los campos de tarjeta.");return}e.numero_tarjeta=this.numero_tarjeta,e.fecha_expiracion=this.fecha_expiracion,e.codigo_seguridad=this.codigo_seguridad}this.pedidoService.crearPedido(e).subscribe({next:n=>{alert("\xA1Pedido realizado con \xE9xito!"),this.pedidoRealizado=!0,this.pedidoId=n.id||null,this.numero_tarjeta="",this.fecha_expiracion="",this.codigo_seguridad="",this.direccion="",this.telefono="",this.metodoPago="tarjeta",setTimeout(()=>this.router.navigate(["/mispedidos"]),3e3)},error:n=>{console.error("Error al realizar el pedido:",n),alert("Hubo un error al procesar el pedido.")}})}descargarPDF(){this.pedidoId&&this.pedidoService.descargarPDF(this.pedidoId).subscribe({next:e=>{let n=window.URL.createObjectURL(e),t=document.createElement("a");t.href=n,t.download=`pedido_${this.pedidoId}.pdf`,t.click(),window.URL.revokeObjectURL(n)},error:e=>{console.error("Error al descargar PDF:",e)}})}static{this.\u0275fac=function(n){return new(n||a)(h($),h(ee),h(N))}}static{this.\u0275cmp=E({type:a,selectors:[["app-pedido"]],standalone:!0,features:[T],decls:37,vars:10,consts:[["pedidoForm","ngForm"],[1,"pedido-container"],[1,"pedido-items"],["class","pedido-item",4,"ngFor","ngForOf"],[1,"pedido-total"],[3,"ngSubmit"],[1,"metodo-pago"],["name","metodoPago","required","",1,"form-select",3,"ngModelChange","ngModel"],["value","tarjeta"],["value","efectivo"],["class","tarjeta-info",4,"ngIf"],[1,"direccion-entrega"],[1,"form-group"],["for","direccion"],["id","direccion","type","text","name","direccion","placeholder","Calle, n\xFAmero, colonia, ciudad","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"telefono-contacto"],["for","telefono"],["id","telefono","type","text","maxlength","10","name","telefono","placeholder","1234567890","required","","pattern","[\\d]{10}",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","btn btn-secondary","style","margin-top: 10px;",3,"click",4,"ngIf"],[1,"pedido-item"],[1,"item-info"],[1,"tarjeta-info"],["for","numeroTarjeta"],["id","numeroTarjeta","type","text","maxlength","16","name","numeroTarjeta","placeholder","1234 5678 9012 3456","required","","pattern","[\\d]{16}",1,"form-control",3,"ngModelChange","ngModel"],["for","fechaExpiracion"],["id","fechaExpiracion","type","month","name","fechaExpiracion","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","cvv"],["id","cvv","type","text","maxlength","3","name","cvv","placeholder","123","required","","pattern","[\\d]{3}",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-secondary",2,"margin-top","10px",3,"click"]],template:function(n,t){if(n&1){let d=P();o(0,"div",1)(1,"h1"),r(2,"Resumen del Pedido"),i(),o(3,"div",2),C(4,ie,9,5,"div",3),i(),o(5,"div",4)(6,"h2"),r(7),v(8,"currency"),i()(),o(9,"form",5,0),y("ngSubmit",function(){return p(d),s(t.realizarPedido())}),o(11,"div",6)(12,"h3"),r(13,"M\xE9todo de Pago"),i(),o(14,"select",7),u("ngModelChange",function(l){return p(d),g(t.metodoPago,l)||(t.metodoPago=l),s(l)}),o(15,"option",8),r(16,"Tarjeta de Cr\xE9dito/D\xE9bito"),i(),o(17,"option",9),r(18,"Efectivo"),i()()(),C(19,ne,15,3,"div",10),o(20,"div",11)(21,"h3"),r(22,"Direcci\xF3n de Entrega"),i(),o(23,"div",12)(24,"label",13),r(25,"Direcci\xF3n"),i(),o(26,"input",14),u("ngModelChange",function(l){return p(d),g(t.direccion,l)||(t.direccion=l),s(l)}),i()()(),o(27,"div",15)(28,"h3"),r(29,"Tel\xE9fono de Contacto"),i(),o(30,"div",12)(31,"label",16),r(32,"Tel\xE9fono"),i(),o(33,"input",17),u("ngModelChange",function(l){return p(d),g(t.telefono,l)||(t.telefono=l),s(l)}),i()()(),o(34,"button",18),r(35,"Realizar Pedido"),i()(),C(36,re,2,0,"button",19),i()}if(n&2){let d=j(10);c(4),_("ngForOf",t.carrito),c(3),x("Total: ",w(8,8,t.calcularTotal()),""),c(7),m("ngModel",t.metodoPago),c(5),_("ngIf",t.metodoPago==="tarjeta"),c(7),m("ngModel",t.direccion),c(7),m("ngModel",t.telefono),c(),_("disabled",!d.form.valid),c(2),_("ngIf",t.pedidoRealizado&&t.pedidoId)}},dependencies:[W,F,I,k,Z,H,J,K,L,G,B,q,Q,X,Y,A,U,R,z],styles:[".pedido-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;background-color:#f9f9f9;border-radius:8px;box-shadow:0 4px 6px #0000001a;font-family:Arial,sans-serif;transition:all .3s ease}.pedido-container[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], .pedido-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .pedido-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#333;margin-bottom:10px}.pedido-items[_ngcontent-%COMP%]{margin-bottom:20px}.pedido-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:15px;border-bottom:1px solid #ddd;background-color:#fff;border-radius:5px;transition:background-color .3s ease}.pedido-item[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.item-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:18px;color:#555}.item-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0;color:#777}.pedido-total[_ngcontent-%COMP%]{margin-bottom:20px;text-align:right}.pedido-total[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;color:#333}.metodo-pago[_ngcontent-%COMP%], .tarjeta-info[_ngcontent-%COMP%], .direccion-entrega[_ngcontent-%COMP%], .telefono-contacto[_ngcontent-%COMP%]{margin-bottom:20px}.form-group[_ngcontent-%COMP%]{margin-bottom:15px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:700;color:#555}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #ccc;border-radius:4px;font-size:14px;transition:border-color .3s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#aaa}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{border-color:#007bff;outline:none}.btn[_ngcontent-%COMP%]{display:block;width:100%;padding:12px;font-size:16px;color:#fff;background-color:#007bff;border:none;border-radius:4px;cursor:pointer;text-align:center;transition:background-color .3s ease}.btn[_ngcontent-%COMP%]:hover{background-color:#0056b3}.btn-secondary[_ngcontent-%COMP%]{background-color:#6c757d;margin-top:10px}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#5a6268}.error-message[_ngcontent-%COMP%]{color:red;font-size:14px;margin-top:10px}"]})}}return a})();export{fe as PedidoComponent};
